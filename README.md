
# 🏗 AIoT 스마트 인프라 대시보드 — 재건축 의사결정 Helper



> 🚀 **현재 구현 상태 (2025-10-06 기준)**  
> - ✅ **1–2사분면 완성:** 서울시 지도 기반 단지 시각화 및 선택 기능 구현  
> - ✅ **테이블 및 필터 기능:** 구 선택, 세대수·면적 범주 필터, 검색/정렬 적용  
> - ✅ **지도 연동 강조표시:** 테이블에서 선택된 단지가 지도 위에서 하이라이트 표시  
> - ✅ **1사분면 반영:** 선택된 단지의 기존 정보(주소·세대수·면적 등)가 신설 조건 입력창에 자동 반영  
> - ⚙️ **1사분면 입력 UI 구성 완료:**  
>   - `원하는 전용 평형(평)`  
>   - `원하는 세대수(신규)`  
>   - `예상 인구증가율(%)`  
>   - `신설 버스 대수`  
>   - `버스 1대 수용 인원(명)`  
> 

> - 🔄 **연동 예정:** 위 입력값이 3사분면(혼잡도 예측)과 4사분면(기대효과 계산)에 실시간 반영되도록 연동 로직 구현 예정  
> - ⚙️ **3–4사분면 프로토타입:** 혼잡도 예측·기대효과 계산(Altair 그래프 + KPI 카드)
---

서울시 재건축 후보지에서 **혼잡도 영향**과 **기대효과(수익성)**를 빠르게 가늠할 수 있도록 만든 *Streamlit* 기반 웹 대시보드입니다.  
타겟은 **건설사(사업성 검토팀)**이며, 1–4사분면 레이아웃로 지도·선택·분석·리포트를 한 화면에서 수행합니다.

---

## ✨ 현재 구현 현황 (2025-10-06 기준)

### 1–2사분면: 지도 + 단지 선택 (구현)
- **구 선택** → 해당 구의 정비사업 단지 리스트와 지도 렌더(pdeck) 동기화
- **좌표 매칭**: `data/서울시_재개발재건축_clean_kakao.csv`의 위경도 기준으로 매칭  
  - 매칭 실패 시 **구 중심 좌표 + 지터**로 보정 표시(시각화 연속성 확보)
- **정규화 스키마**: 원본 CSV(`data/seoul_redev_projects.csv`)를 표준 컬럼으로 변환
  - `households(세대수)`, `land_area_m2(면적)`, `far(용적률%)`, `floors_show(층수 표현)`, `status(진행단계)` 등
- **테이블 필터/정렬**: 주소/조합명 검색, 세대수/면적 범주, 0/결측치 숨김, 정렬 옵션, Top N
- **단일 선택 보장**: 표 내 체크박스로 단지 1개만 선택 유지
- **툴팁**: 주소/구/세대수/면적 표시

### 1사분면: 신설 조건 입력 (구현)
- 선택 단지의 **기존 정보**(주소/조합/구/세대수/면적) 표시
- 신규 조건 입력: `원하는 평형(평)`, `원하는 세대수`, `예상 인구증가율(%)`, `신설 버스 대수`, `버스 1대 수용 인원`

> 🔧 **버그 대응(임시 해결)**  
> `st.number_input` 기본값이 상한을 넘을 때 발생하던 에러를 **클램프**로 해결:
> ```python
> def _clamp(v, lo, hi):
>     return max(lo, min(hi, v))
>
> min_val, max_val = 100, 3000
> base_households = int(current["households"]) if pd.notna(current["households"]) else 500
> default_desired = base_households + 200
>
> desired_households = st.number_input(
>     "원하는 세대수(신규)",
>     min_value=min_val,
>     max_value=max_val,
>     value=_clamp(default_desired, min_val, max_val),
>     step=50,
> )
> ```

### 3사분면: 혼잡도 증가 예측 (프로토타입 구현)
- 기본 혼잡도 지수(난수, 45~65) + 피크-오프패턴(사인함수)로 **Baseline 곡선** 생성
- **증가 인구**와 **신설 버스 흡수효과**를 반영한 단순 선형 모델로 `After` 곡선 산출
- Altair로 **시간대별 혼잡도(0~100)** 라인 차트 표시

> 수식(임시):
> - `added_population = Δ세대수 × 2.3(person/HH) × (1 + 증가율)`  
> - `congestion_delta = α × added_population − β × (신설버스 × 버스정원)`  
> - 파라미터: `α=0.004`, `β=0.0006` (튜닝값)

### 4사분면: 기대효과(수익성) 리포트 (프로토타입 구현)
- 입력: `평당 분양가/매매가(만원)`, `평당 총비용(만원)`
- 계산: `예상 총수익(십억)` = `(분양가-비용) × 평수 × 세대수 / 10,000`
- KPI 카드: **예상 수익**, **예측 혼잡도 지수**, **신규 세대수**

---

## 📂 폴더 구조

```
app/
 └─ app.py                  # Streamlit 메인 앱
data/
 ├─ seoul_redev_projects.csv                 # 원본 프로젝트 CSV
 └─ 서울시_재개발재건축_clean_kakao.csv       # 주소/좌표 매칭 CSV
README.md
requirements.txt
```

---

## 🧰 기술 스택
- **Frontend/앱 프레임워크**: Streamlit
- **시각화**: pydeck(지도), Altair(그래프)
- **데이터 처리**: pandas, numpy
- **유틸**: Pathlib, datetime

---

## ⚙️ 실행 방법

```bash
# 0) (선택) 가상환경
python -m venv .venv
# Windows
.venv\Scripts\activate
# macOS/Linux
source .venv/bin/activate

# 1) 패키지 설치
pip install -r requirements.txt

# 2) 앱 실행
streamlit run app/app.py
```

> 데이터 파일은 `data/` 폴더에 위치해야 합니다.  
> 인코딩은 자동 판별(`smart_read_csv`)이 적용되며, 실패 시 `errors="replace"`로 최대한 읽습니다.

---

## 🗂 데이터 스키마(정규화 결과)

| 컬럼 | 설명 |
|---|---|
| `apt_id` | 사업번호(문자열) |
| `name` | 단지/정비구역명(조합명 대체 포함) |
| `org_name` | 추진위원회/조합명(원본 표시) |
| `biz_type`, `op_type` | 사업/운영 구분 |
| `gu` | 자치구 |
| `address` | 주소(대표지번/위치) |
| `households` | 세대수(숫자) |
| `land_area_m2` | 면적(㎡, 숫자) |
| `far` | 용적률(%) |
| `floors`, `floors_up`, `floors_down` | 층수(숫자) |
| `floors_show` | 표시용 층수 문자열(예: `지상 35 / 지하 3`) |
| `status` | 진행단계(문자열) |
| `lat`, `lon` | 좌표(좌표 CSV 매칭 또는 구 중심 지터) |
| `address_display` | 표시용 주소(full_address 우선) |

---

## 🔵 필요 데이터(확장 계획)
1. **아파트 데이터**(재건축 승인/허가) ✅ 반영 중  
2. ~~재건축 시 세대수 선정 기준~~ (내부 입력으로 대체)  
3. **평당 매매가** (현재 사용자 입력 → 향후 실거래/공공데이터 연동 예정)  
4. **버스 데이터**: 노선 개설 기준, 1대 신설 시 완화 예상 혼잡도, 1대 정원 (현재 파라미터 입력 → 향후 API/통계 반영)  
5. **토지면적**(토지이음) ✅ 컬럼 반영 중

---

## 🧪 모델/로직 주의사항
- 3사분면 수식은 **탐색적 가정 기반**입니다(정책/실제 교통 모델 아님).
- 파라미터(α, β, 1대 정원, HH당 인구)는 설정값이며 **보정 필요**.
- 입력값 경계 에러 방지용 **클램프 처리** 적용(`st.number_input`).

---

## 🗺 로드맵
- [ ] 실거래/공공 데이터 연동: 평당가, 인구/유동량, 버스 혼잡도/노선정보
- [ ] 단지별 도로망/정류장 근접성 스코어 계산
- [ ] 혼잡도 예측: 피크-오프 모델 정교화, S-커브·혼잡 임계치 반영
- [ ] 민감도 분석(스파이더/토네이도 차트)
- [ ] 결과 **PDF/CSV 보고서 내보내기**
- [ ] 입력 시나리오 저장/불러오기

---

## 🤝 기여/이슈
- 버그/요청사항은 이슈로 등록해주세요.  
- 데이터 정합성(세대수/면적) 자동 비교 도우미 포함: 원본 vs 표시값 간 단순 검증 탭 제공.

---

## 📜 라이선스
- 데이터 출처의 사용조건을 준수하세요. 앱 코드는 프로젝트 라이선스에 따릅니다.
